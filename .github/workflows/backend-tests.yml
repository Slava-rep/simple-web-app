name: Backend Tests

on:
  push:
    branches: [ main, master ]
    paths:
      - '**.py' # Срабатывает при изменении любого Python файла
      - '!tests/test_ui/**' #исключает файлы из срабатывания
      - '!tests/test_api/**' #исключает файлы из срабатывания
  pull_request:
    branches: [ main, master ] #срабатывает на пул реквесты в эти ветки

jobs: # Определяет рабочие процессы
  test: # имя задачи
    runs-on: ubuntu-latest #использует виртуальную машину с убунтой
    strategy: 
      matrix: #матрица для тестирования на разных версиях питона
        python-version: [3.12]

    steps:
    - uses: actions/checkout@v4 #чекаутит код из репо
    - name: Set up Python ${{ matrix.python-version }} #устанавливает питон
      uses: actions/setup-python@v4 #использует экшен для установки питона
      with:
        python-version: ${{ matrix.python-version }} #устанавливает версию питона из матрицы
    
    - name: Install dependencies 
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt 
        
    - name: Run backend tests
      env: 
        PYTHONPATH: . #устанавливает переменную окружения PYTHONPATH
      run: | 
        python -m pytest tests/test_unit.py tests/test_integration.py -v --html=test-report-backend.html --self-contained-html
        
    - name: Upload test results
      uses: actions/upload-artifact@v4 #загружает артефакты (отчеты) из воркфлоу
      with:
        name: backend-test-results #имя артефакта
        path: test-report-backend.html #путь к файлу отчета